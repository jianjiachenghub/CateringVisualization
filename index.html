<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>学生大数据平台</title>
    <link href="css/bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">
    <link rel="stylesheet" href="css/tree.css">
    <link rel="stylesheet" href="css/tip-yellowsimple.css">

    <style>
        .t_title{
            width: 100%;
            height: 100%;
            text-align: center;
            font-size: 2.5em;
            line-height: 80px;
            color: #fff;
        }
        #chart_map{
            cursor: pointer;
        }
        .t_show{
            position: absolute;
            top: 0;
            right: 0;
            border-radius: 2px;
            background: #2C58A6;
            padding: 2px 5px;
            color: #fff;
            cursor: pointer;
        }
        #button1{
            float: right;/*设置浮动*/
            width: 150px;/*设置按钮宽度*/
            height: 35px;/*设置按钮高度*/
            color:white;/*字体颜色*/
            background-color:steelblue;/*按钮背景颜色*/
            border-radius: 3px;/*让按钮变得圆滑一点*/
            border-width: 0;/*消去按钮丑的边框*/
            margin: 0;/*margin0*/
            outline: none;/*取消轮廓*/
            font-size: 15px;/*设置字体大小*/
            font-weight: lighter;/*设置字体粗细*/
            text-align: center;/*字体居中*/
            cursor: pointer;/*设置鼠标箭头手势*/
        }
        #h2{
            margin:auto;
        }
        #chart_4{

            margin: auto;
            background-color:#FFCCCC;
        }
    </style>
</head>
<body>

<!--header-->
<div class="header">
    <div class="bg_header">
        <div class="header_nav fl t_title">
            绵阳市餐饮数据可视化平台
        </div> 
    </div>
</div>

<!--main-->
<div class="data_content">


    <div class="data_main">
        <div class="main_left fl">

        </div>
        <div class="main_center fl">
            <div class="center_text">
                <!--左上边框-->
                <div class="t_line_box">
                    <i class="t_l_line"></i> 
                    <i class="l_t_line"></i> 
                </div> 
                <!--右上边框-->
                <div class="t_line_box">
                    <i class="t_r_line"></i> 
                    <i class="r_t_line"></i> 
                </div> 
                <!--左下边框-->
                <div class="t_line_box">
                    <i class="l_b_line"></i> 
                    <i class="b_l_line"></i> 
                </div> 
                 <!--右下边框-->
                 <div class="t_line_box">
                    <i class="r_b_line"></i> 
                    <i class="b_r_line"></i> 
                </div> 
                <div class="main_title">
                    <img src="img/t_3.png" alt="">
                    分类餐饮地理位置
                </div>
                <div id="chart_map" style="width:100%;height:858px;"></div>
            </div>
        </div>
        <div class="main_right fr">
            <div class="right_1">
                <!--左上边框-->
                <div class="t_line_box">
                    <i class="t_l_line"></i> 
                    <i class="l_t_line"></i> 
                </div> 
                <!--右上边框-->
                <div class="t_line_box">
                    <i class="t_r_line"></i> 
                    <i class="r_t_line"></i> 
                </div> 
                <!--左下边框-->
                <div class="t_line_box">
                    <i class="l_b_line"></i> 
                    <i class="b_l_line"></i> 
                </div> 
                    <!--右下边框-->
                    <div class="t_line_box">
                    <i class="r_b_line"></i> 
                    <i class="b_r_line"></i> 
                </div> 
                <div class="main_title" style="z-index: 2">
                    <img src="img/t_4.png" alt="">
                    店铺数据可视化
                </div>
                <div id="chart_3" class="echart t_btn7" style="width:100%;height: 280px;z-index: 1"></div>
            </div>
            <div class="right_2">
                <!--左上边框-->
                <div class="t_line_box">
                    <i class="t_l_line"></i> 
                    <i class="l_t_line"></i> 
                </div> 
                <!--右上边框-->
                <div class="t_line_box">
                    <i class="t_r_line"></i> 
                    <i class="r_t_line"></i> 
                </div> 
                <!--左下边框-->
                <div class="t_line_box">
                    <i class="l_b_line"></i> 
                    <i class="b_l_line"></i> 
                </div> 
                    <!--右下边框-->
                    <div class="t_line_box">
                    <i class="r_b_line"></i> 
                    <i class="b_r_line"></i> 
                </div> 
                <div class="main_title">
                    <img src="img/t_5.png" alt="">
                    娱乐类数据
                </div>
                <div id="chart_10" class="echart fl t_btn4" style="width:100%;height: 280px;cursor: pointer;"></div>
            </div>
            <div class="right_2" id='goodsIndex'>
                <!--左上边框-->
                <div class="t_line_box">
                    <i class="t_l_line"></i> 
                    <i class="l_t_line"></i> 
                </div> 
                <!--右上边框-->
                <div class="t_line_box">
                    <i class="t_r_line"></i> 
                    <i class="r_t_line"></i> 
                </div> 
                <!--左下边框-->
                <div class="t_line_box">
                    <i class="l_b_line"></i> 
                    <i class="b_l_line"></i> 
                </div> 
                    <!--右下边框-->
                    <div class="t_line_box">
                    <i class="r_b_line"></i> 
                    <i class="b_r_line"></i> 
                </div> 
                <div class="main_title">
                    <img src="img/t_5.png" alt="">
                    订单好评度数据展示
                </div>
                <svg id="chart_4" class="echart fl t_btn4" style="width:100%;height: 280px;cursor: pointer;"></svg>
                <button id='button1' onclick="sort()">排序</button>
            </div>
        </div>
    </div>
    
</div>

</body>
<script type="text/javascript" src="https://api.map.baidu.com/getscript?v=3.0&ak=SZV4I0uYBz8ZrilMbs5sMyab6ZfqGhpP"></script>
<script src="js/jquery-2.2.1.min.js"></script>
<script type="text/javascript" src="js/d3.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.poshytip.js"></script>
<script src="js/common.js"></script>
<script src="js/comboTreePlugin.js"></script>
<script src="js/echarts.min.js"></script>
<script src="js/dataTool.js"></script>
<script src="js/index.js"></script>
<script src="js/china.js"></script>
<script src="js/hunan.js"></script>
<script src="js/map.js"></script>

<script>
    var data1 = localStorage.getItem("stuData")
    if(!data1){
        window.location.herf="page/jQueryLogin/index.html";
    }

function outProject(){
    var data = localStorage.getItem("stuData")
    console.log(data)
    if(data){
        localStorage.removeItem('stuData')
        window.location.herf="page/jQueryLogin/index.html";
    }
}
var uploadedDataURL = "./data/shop2.json";
    var myChart = echarts.init(document.getElementById('chart_3'));
    myChart.showLoading();

    $.getJSON(uploadedDataURL, function (rawData) {

        myChart.hideLoading();

        function convert(source, target, basePath) {
            for (var key in source) {
                var path = basePath ? (basePath + '.' + key) : key;
                if (key.match(/^\$/)) {

                }
                else {
                    target.children = target.children || [];
                    var child = {
                        name: path
                    };
                    target.children.push(child);
                    convert(source[key], child, path);
                }
            }

            if (!target.children) {
                target.value = source.$count || 1;
            }
            else {
                target.children.push({
                    name: basePath,
                    value: source.$count
                });
            }
        }

        var data = [];

        convert(rawData, data, '');
        var formatUtil = echarts.format;
        myChart.setOption(option = {

            tooltip: {formatter: function (info) {
                    var value = info.value;
                    var treePathInfo = info.treePathInfo;
                    var treePath = [];

                    for (var i = 1; i < treePathInfo.length; i++) {
                        treePath.push(treePathInfo[i].name);
                    }
                    return [
                        '<div class="tooltip-title">' + formatUtil.encodeHTML(treePath.join('/')) + '</div>',
                        '店铺数: ' + formatUtil.addCommas(value)
                    ].join('');
                }},
            series: [{
                name: '绵阳市',
                type: 'treemap',
                visibleMin: 500,
                data: data.children,
                leafDepth:1,
                levels: [
                    {
                        itemStyle: {
                            normal: {
                                borderColor: '#555',
                                borderWidth: 4,
                                gapWidth: 4
                            }
                        }
                    },
                    {
                        colorSaturation: [0.3, 0.6],
                        itemStyle: {
                            normal: {
                                borderColorSaturation: 0.7,
                                gapWidth: 2,
                                borderWidth: 2
                            }
                        }
                    },
                    {
                        colorSaturation: [0.3, 0.5],
                        itemStyle: {
                            normal: {
                                borderColorSaturation: 0.6,
                                gapWidth: 1
                            }
                        }
                    },
                    {
                        colorSaturation: [0.3, 0.5]
                    }
                ]
            }]
        })
    });



    var dataset = [0.77, 0.81, 0.81, 0.82, 0.84, 0.81, 0.77, 0.44, 0.78, 0.80, 0.72, 0.89, 0.76, 0.86, 0.51, 0.84, 0.46, 0.89, 0.80, 0.78, 0.85].reverse();
            var yArray1 = ["咖啡厅 ", "川菜 ", "火锅 ", "其他 ", "快餐简餐 ", "茶馆 ", "西餐 ", "东北菜 ", "烧烤 ", "小吃面食 ", "酒吧 ", "面包甜点 ", "粤菜 ", "新疆菜 ", "清真菜 ", "自助餐 ", "湘菜 ", "江浙菜 ", "日本料理 ", "韩国料理 ", "东南亚菜 ", ];
            var yArray2 = [];
            var svg = d3.select("svg");
            console.log(dataset.length,yArray1.length)


            //绘制函数
            function draw() {
                for (var i = 0; i < yArray1.length; i++) {
                    yArray2.push(137 - i * 21);
                }

                var scale = d3.scaleLinear()
                    .domain([0, d3.max(dataset)])
                    .range([0, 300]);

                var yScale = d3.scaleOrdinal()
                    .domain(yArray1)
                    .range(yArray2);


                svg.selectAll("rect")
                    .data(dataset)
                    .enter()
                    .append("rect")
                    .attr("x", 50)
                    .attr("y", function(d, i) {
                        return i * 21 + 20;
                    })
                    .attr("width", function(d) {
                        return scale(d);
                    })
                    .attr("height", 20)
                    .attr("fill", "steelblue");

                svg.selectAll("text")
                    .data(dataset)
                    .enter()
                    .append("text")
                    .attr("x", function(d) {
                        return scale(d) + 50;
                    }) //左上角
                    .attr("y", function(d, i) {
                        return 21 * i + 36
                    }) //基线（文字底部）
                    .attr("color", "red")
                    .style("font-size", "70%")
                    .text(function(d) {
                        return d3.format('.0%')(d);
                    });

                d3.selectAll("rect") //选择第一个矩形
                    .on("mouseover",function(){
                        d3.select(this).attr("fill","#FFFFCC");
                    })
                    .on("mouseout",function(d){
                        d3.select(this)
                            .transition()
                            .duration(250)
                            .attr("fill","steelblue");
                    })


                // 设置过渡结束状态

                var xAxis = d3.axisBottom().scale(scale).ticks(6).tickFormat(d3.format(".0%"));

                svg.append("g")
                    .attr("transform", "translate(50,462)")
                    .call(xAxis);
                var yAxis = d3.axisLeft().scale(yScale).tickSize(0);
                svg.append("g")
                    .attr("transform", "translate(50,310)")
                    .call(yAxis);

            }

            draw();

            //排序函数
            function sort() {
                //定义数组来存放原始数据和排序后的数据
                var initData = [];
                var newyArray = [];
                var newDataset = [];
                for (var i = 0; i < yArray1.length; i++) {
                    var obj = {};
                    obj.name = yArray1[yArray1.length -1- i];
                    obj.num = dataset[i];
                    initData.push(obj);
                }
                console.log('初始数组：', initData)

                //对原始数据排序
                function compare(key) {
                    return function(value1, value2) {
                        var val1 = value1[key];
                        var val2 = value2[key];
                        return val1 - val2;
                    }
                }
                initData.sort(compare('num'));
                console.log('更改后的数组：', initData);



                //从排好序的数组中生成两个新数组
                initData.forEach(item => {
                    newyArray.push(item.name);
                    newDataset.push(item.num);
                });



                //对初始数据进行排序


                console.log(initData)
                console.log(newyArray);
                console.log(newDataset);
                //用新数组替换元原始数组
                dataset = newDataset;
                yArray1 = newyArray.reverse();
                //清空svg内容
                svg.selectAll("svg > *").remove();

                draw();
            }

            $('#chart_3').click(()=>{
                window.open('./page/placeTree.html')
            })
            $('#goodsIndex').click(()=>{
                window.open('./page/goodIndex.html')
            })
</script>
</html>